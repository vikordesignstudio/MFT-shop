import React, { useState, useEffect } from 'react';
import { ShoppingCart, Search, Menu, X, ChevronDown, Star, Heart, ArrowRight, Truck, ShieldCheck, Smile } from 'lucide-react';

// --- Mock Data ---
const PRODUCTS = [
  {
    id: 1,
    name: "–î–∏—Ç—è—á–∞ –∑—É–±–Ω–∞ –ø–∞—Å—Ç–∞ ¬´–ë–∞–Ω–∞–Ω¬ª",
    price: 120,
    category: "kids",
    image: "https://images.unsplash.com/photo-1559599101-f09722fb4948?auto=format&fit=crop&q=80&w=800",
    rating: 4.8,
    isNew: true,
    description: "–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞ –∑—É–±–Ω–∞ –ø–∞—Å—Ç–∞ –¥–ª—è –¥—ñ—Ç–µ–π –≤—ñ–¥ 3 —Ä–æ–∫—ñ–≤. –ë–µ–∑–ø–µ—á–Ω–∞ –ø—Ä–∏ –∫–æ–≤—Ç–∞–Ω–Ω—ñ."
  },
  {
    id: 2,
    name: "–ù–∞–±—ñ—Ä –ø–∞—Å—Ç (3 —à—Ç)",
    price: 320,
    category: "sets",
    image: "https://images.unsplash.com/photo-1571781926291-2805530353f3?auto=format&fit=crop&q=80&w=800",
    rating: 5.0,
    isNew: false,
    description: "–í–∏–≥—ñ–¥–Ω–∏–π –Ω–∞–±—ñ—Ä –¥–ª—è –≤—Å—ñ—î—ó —Ä–æ–¥–∏–Ω–∏. –¢—Ä–∏ —Ä—ñ–∑–Ω—ñ —Å–º–∞–∫–∏."
  },
  {
    id: 3,
    name: "–ë–∞–º–±—É–∫–æ–≤–∞ —â—ñ—Ç–∫–∞",
    price: 85,
    category: "accessories",
    image: "https://images.unsplash.com/photo-1629196924294-1a958b1d926c?auto=format&fit=crop&q=80&w=800",
    rating: 4.5,
    isNew: false,
    description: "–ï–∫–æ–ª–æ–≥—ñ—á–Ω–∞ —â—ñ—Ç–∫–∞ —Å–µ—Ä–µ–¥–Ω—å–æ—ó –∂–æ—Ä—Å—Ç–∫–æ—Å—Ç—ñ."
  },
  {
    id: 4,
    name: "–í—ñ–¥–±—ñ–ª—é—é—á–∞ –ø–∞—Å—Ç–∞ Charcoal",
    price: 150,
    category: "adults",
    image: "https://images.unsplash.com/photo-1559599189-fe84dea4eb79?auto=format&fit=crop&q=80&w=800",
    rating: 4.7,
    isNew: true,
    description: "–ú'—è–∫–µ –≤—ñ–¥–±—ñ–ª—é–≤–∞–Ω–Ω—è –±–µ–∑ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –µ–º–∞–ª—ñ."
  },
  {
    id: 5,
    name: "–û–ø–æ–ª—ñ—Å–∫—É–≤–∞—á –ú'—è—Ç–∞",
    price: 190,
    category: "adults",
    image: "https://images.unsplash.com/photo-1608248597279-f99d160bfbc8?auto=format&fit=crop&q=80&w=800",
    rating: 4.9,
    isNew: false,
    description: "–°–≤—ñ–∂–∏–π –ø–æ–¥–∏—Ö –Ω–∞ 12 –≥–æ–¥–∏–Ω."
  }
];

const CATEGORIES = [
  { id: 'all', name: '–í—Å—ñ —Ç–æ–≤–∞—Ä–∏' },
  { id: 'adults', name: '–î–æ—Ä–æ—Å–ª–∏–º' },
  { id: 'kids', name: '–î—ñ—Ç—è–º' },
  { id: 'accessories', name: '–ê–∫—Å–µ—Å—É–∞—Ä–∏' },
  { id: 'sets', name: '–ù–∞–±–æ—Ä–∏' }
];

// --- Components ---

const NotificationBar = () => (
  <div className="bg-teal-700 text-white text-xs sm:text-sm py-2 text-center px-4 font-medium">
    –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å –≤—ñ–¥ 1000 –≥—Ä–Ω üöö
  </div>
);

const Header = ({ cartCount, onOpenCart, onNavigate, onSearch }) => {
  const [isCatalogOpen, setIsCatalogOpen] = useState(false);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");

  const handleSearch = (e) => {
    e.preventDefault();
    onSearch(searchQuery);
  };

  return (
    <header className="sticky top-0 z-50 bg-white shadow-sm">
      <NotificationBar />
      <div className="container mx-auto px-4 py-4">
        <div className="flex items-center justify-between gap-4">
          
          {/* Logo */}
          <div 
            className="text-2xl font-bold text-teal-800 cursor-pointer flex-shrink-0"
            onClick={() => onNavigate('home')}
          >
            DENTISTORY
          </div>

          {/* Desktop Nav */}
          <nav className="hidden md:flex items-center gap-8 font-medium text-gray-700">
            <div 
              className="relative group"
              onMouseEnter={() => setIsCatalogOpen(true)}
              onMouseLeave={() => setIsCatalogOpen(false)}
            >
              <button 
                className="flex items-center gap-1 hover:text-teal-600 py-2"
                onClick={() => onNavigate('catalog')}
              >
                –ö–∞—Ç–∞–ª–æ–≥ <ChevronDown size={16} />
              </button>
              
              {/* Dropdown Catalog */}
              {isCatalogOpen && (
                <div className="absolute top-full left-0 w-56 bg-white shadow-lg rounded-b-lg border-t-2 border-teal-500 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200">
                  <ul className="py-2">
                    {CATEGORIES.slice(1).map(cat => (
                      <li key={cat.id}>
                        <button 
                          onClick={() => onNavigate('catalog', cat.id)}
                          className="block w-full text-left px-4 py-2 hover:bg-teal-50 text-sm hover:text-teal-700 transition-colors"
                        >
                          {cat.name}
                        </button>
                      </li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
            
            <button onClick={() => onNavigate('about')} className="hover:text-teal-600 transition-colors">–ü—Ä–æ –Ω–∞—Å</button>
            <button onClick={() => onNavigate('locations')} className="hover:text-teal-600 transition-colors">–¢–æ—á–∫–∏ –ø—Ä–æ–¥–∞–∂—É</button>
            <button onClick={() => onNavigate('contacts')} className="hover:text-teal-600 transition-colors">–ö–æ–Ω—Ç–∞–∫—Ç–∏</button>
          </nav>

          {/* Search & Cart */}
          <div className="flex items-center gap-4 flex-shrink-0">
            <form onSubmit={handleSearch} className="hidden lg:flex items-center relative">
              <input 
                type="text" 
                placeholder="–ü–æ—à—É–∫..." 
                className="pl-3 pr-8 py-1.5 border border-gray-300 rounded-full text-sm focus:outline-none focus:border-teal-500 w-48 transition-all"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
              />
              <button type="submit" className="absolute right-2 text-gray-400 hover:text-teal-600">
                <Search size={16} />
              </button>
            </form>

            <button className="lg:hidden text-gray-600">
              <Search size={24} />
            </button>

            <button onClick={onOpenCart} className="relative text-gray-800 hover:text-teal-600 transition-colors">
              <ShoppingCart size={24} />
              {cartCount > 0 && (
                <span className="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
                  {cartCount}
                </span>
              )}
            </button>

            <button 
              className="md:hidden text-gray-800"
              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
            >
              {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
            </button>
          </div>
        </div>
      </div>
      
      {/* Mobile Menu */}
      {isMobileMenuOpen && (
        <div className="md:hidden bg-white border-t p-4 flex flex-col gap-4">
          <button onClick={() => {onNavigate('catalog'); setIsMobileMenuOpen(false)}} className="text-left font-medium">–ö–∞—Ç–∞–ª–æ–≥</button>
          <button onClick={() => {onNavigate('about'); setIsMobileMenuOpen(false)}} className="text-left">–ü—Ä–æ –Ω–∞—Å</button>
          <button onClick={() => {onNavigate('locations'); setIsMobileMenuOpen(false)}} className="text-left">–¢–æ—á–∫–∏ –ø—Ä–æ–¥–∞–∂—É</button>
          <button onClick={() => {onNavigate('contacts'); setIsMobileMenuOpen(false)}} className="text-left">–ö–æ–Ω—Ç–∞–∫—Ç–∏</button>
        </div>
      )}
    </header>
  );
};

const Hero = ({ onShopNow }) => (
  <section className="bg-teal-50">
    <div className="container mx-auto px-4 flex flex-col md:flex-row h-auto md:h-[500px]">
      <div className="md:w-1/2 flex flex-col justify-center py-12 md:py-0 md:pr-12">
        <span className="text-teal-600 font-bold uppercase tracking-wider mb-2">–¢–æ–≤–∞—Ä –º—ñ—Å—è—Ü—è</span>
        <h1 className="text-4xl md:text-5xl font-bold text-gray-900 mb-6 leading-tight">
          –Ü–¥–µ–∞–ª—å–Ω–∞ –ø–æ—Å–º—ñ—à–∫–∞ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è —Ç—É—Ç
        </h1>
        <p className="text-gray-600 mb-8 text-lg">
          –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏, –±–µ–∑–ø–µ—á–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ —Ç–∞ –µ–∫–æ–ª–æ–≥—ñ—á–Ω–µ –ø–∞–∫—É–≤–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞—à—É –Ω–æ–≤—É –ª—ñ–Ω—ñ–π–∫—É –¥–ª—è —á—É—Ç–ª–∏–≤–∏—Ö –∑—É–±—ñ–≤.
        </p>
        <button 
          onClick={onShopNow}
          className="bg-teal-600 text-white px-8 py-4 rounded-lg font-semibold hover:bg-teal-700 transition-colors self-start shadow-lg hover:shadow-xl flex items-center gap-2"
        >
          –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥ <ArrowRight size={20} />
        </button>
      </div>
      <div className="md:w-1/2 relative h-64 md:h-full">
        <img 
          src="https://images.unsplash.com/photo-1559599238-308793637427?auto=format&fit=crop&q=80&w=1000" 
          alt="Hero Banner" 
          className="w-full h-full object-cover rounded-b-2xl md:rounded-b-none md:rounded-bl-[100px]"
        />
      </div>
    </div>
  </section>
);

const BrandAdvantages = () => (
  <section className="bg-white py-6 border-b border-gray-100">
    <div className="container mx-auto px-4">
      <div className="flex flex-wrap justify-around items-center gap-6 text-gray-500 uppercase text-xs font-bold tracking-widest">
        <div className="flex items-center gap-2">
          <ShieldCheck className="text-teal-500" /> –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∞ —è–∫—ñ—Å—Ç—å
        </div>
        <div className="flex items-center gap-2">
          <Truck className="text-teal-500" /> –®–≤–∏–¥–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∞
        </div>
        <div className="flex items-center gap-2">
          <Smile className="text-teal-500" /> 100% –ó–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è
        </div>
        <div className="flex items-center gap-2">
          <Star className="text-teal-500" /> –¢–æ–ø–æ–≤—ñ –±—Ä–µ–Ω–¥–∏
        </div>
      </div>
    </div>
  </section>
);

// Visual Categories Block (Addressing user question)
const VisualCategories = ({ onSelectCategory }) => (
  <section className="py-12 bg-white">
    <div className="container mx-auto px-4">
      <h2 className="text-2xl font-bold text-gray-800 mb-8 text-center">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h2>
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        {CATEGORIES.slice(1).map(cat => (
          <div 
            key={cat.id} 
            onClick={() => onSelectCategory(cat.id)}
            className="group cursor-pointer relative overflow-hidden rounded-xl aspect-square bg-gray-100"
          >
            <div className="absolute inset-0 bg-teal-900/10 group-hover:bg-teal-900/30 transition-colors z-10"></div>
             {/* Placeholder graphics using simple colored blocks instead of images for reliability */}
            <div className={`w-full h-full flex items-center justify-center bg-gradient-to-br ${
                cat.id === 'kids' ? 'from-yellow-100 to-yellow-200' : 
                cat.id === 'adults' ? 'from-blue-100 to-blue-200' :
                cat.id === 'sets' ? 'from-purple-100 to-purple-200' : 'from-green-100 to-green-200'
            }`}>
                 <span className="text-4xl opacity-50">
                    {cat.id === 'kids' ? 'üß∏' : cat.id === 'adults' ? 'ü¶∑' : cat.id === 'sets' ? 'üéÅ' : 'ü™•'}
                 </span>
            </div>
            <div className="absolute bottom-4 left-4 z-20">
              <h3 className="text-lg font-bold text-gray-800 group-hover:text-teal-700 transition-colors">{cat.name}</h3>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
);

const ProductCard = ({ product, onClick, onAddToCart }) => (
  <div className="bg-white rounded-lg border border-gray-100 hover:shadow-lg transition-all duration-300 group flex flex-col h-full">
    <div className="relative aspect-square overflow-hidden bg-gray-100 rounded-t-lg">
      <img 
        src={product.image} 
        alt={product.name} 
        className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 cursor-pointer"
        onClick={() => onClick(product)}
      />
      {product.isNew && (
        <span className="absolute top-2 left-2 bg-teal-500 text-white text-xs px-2 py-1 rounded">–ù–æ–≤–∏–Ω–∫–∞</span>
      )}
      <button 
        className="absolute top-2 right-2 p-2 bg-white rounded-full shadow opacity-0 group-hover:opacity-100 transition-opacity hover:text-red-500"
      >
        <Heart size={16} />
      </button>
    </div>
    <div className="p-4 flex flex-col flex-grow">
      <div className="text-xs text-gray-500 mb-1 capitalize">{product.category}</div>
      <h3 
        className="font-medium text-gray-900 mb-2 cursor-pointer hover:text-teal-600"
        onClick={() => onClick(product)}
      >
        {product.name}
      </h3>
      <div className="flex items-center gap-1 mb-3">
        {[...Array(5)].map((_, i) => (
          <Star 
            key={i} 
            size={12} 
            className={`${i < Math.floor(product.rating) ? "text-yellow-400 fill-yellow-400" : "text-gray-300"}`} 
          />
        ))}
        <span className="text-xs text-gray-400 ml-1">({product.rating})</span>
      </div>
      <div className="mt-auto flex items-center justify-between">
        <span className="text-lg font-bold text-gray-900">{product.price} –≥—Ä–Ω</span>
        <button 
          onClick={(e) => { e.stopPropagation(); onAddToCart(product); }}
          className="bg-gray-100 text-gray-900 hover:bg-teal-600 hover:text-white p-2 rounded-lg transition-colors"
        >
          <ShoppingCart size={18} />
        </button>
      </div>
    </div>
  </div>
);

const Catalog = ({ categoryFilter, products, onProductClick, onAddToCart }) => {
  const [selectedFilters, setSelectedFilters] = useState({
    category: categoryFilter || 'all',
    priceRange: 'all',
    brand: []
  });

  // Update internal state if prop changes
  useEffect(() => {
    if (categoryFilter) {
      setSelectedFilters(prev => ({ ...prev, category: categoryFilter }));
    }
  }, [categoryFilter]);

  const handleFilterChange = (type, value) => {
    setSelectedFilters(prev => ({ ...prev, [type]: value }));
  };

  const filteredProducts = products.filter(p => {
    if (selectedFilters.category !== 'all' && p.category !== selectedFilters.category) return false;
    // Add logic for other filters here
    return true;
  });

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä—ñ–≤</h1>
      <div className="flex flex-col md:flex-row gap-8">
        
        {/* Sidebar Filters */}
        <aside className="w-full md:w-1/4 space-y-8">
          <div>
            <h3 className="font-bold mb-4">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</h3>
            <div className="space-y-2">
              {CATEGORIES.map(cat => (
                <label key={cat.id} className="flex items-center gap-2 cursor-pointer">
                  <input 
                    type="radio" 
                    name="category" 
                    checked={selectedFilters.category === cat.id}
                    onChange={() => handleFilterChange('category', cat.id)}
                    className="text-teal-600 focus:ring-teal-500"
                  />
                  <span className="text-gray-700">{cat.name}</span>
                </label>
              ))}
            </div>
          </div>
          
          <div>
            <h3 className="font-bold mb-4">–ü–æ—Ç—Ä–µ–±–∞</h3>
            <div className="space-y-2">
              <label className="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" className="rounded text-teal-600 focus:ring-teal-500"/>
                <span className="text-gray-700">–í—ñ–¥–±—ñ–ª—é–≤–∞–Ω–Ω—è</span>
              </label>
              <label className="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" className="rounded text-teal-600 focus:ring-teal-500"/>
                <span className="text-gray-700">–ß—É—Ç–ª–∏–≤—ñ –∑—É–±–∏</span>
              </label>
              <label className="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" className="rounded text-teal-600 focus:ring-teal-500"/>
                <span className="text-gray-700">–ó–∞—Ö–∏—Å—Ç —è—Å–µ–Ω</span>
              </label>
            </div>
          </div>
        </aside>

        {/* Product Grid */}
        <div className="w-full md:w-3/4">
          <div className="grid grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredProducts.map(product => (
              <ProductCard 
                key={product.id} 
                product={product} 
                onClick={onProductClick}
                onAddToCart={onAddToCart}
              />
            ))}
          </div>
          {filteredProducts.length === 0 && (
            <div className="text-center py-12 text-gray-500">–¢–æ–≤–∞—Ä—ñ–≤ –∑–∞ –≤–∏–±—Ä–∞–Ω–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</div>
          )}
        </div>
      </div>
    </div>
  );
};

const ProductDetail = ({ product, onBack, onAddToCart, allProducts }) => {
  // Recommendation Logic: Find 2 items that are NOT current product
  const recommended = allProducts
    .filter(p => p.id !== product.id)
    .slice(0, 2);

  return (
    <div className="container mx-auto px-4 py-8 animate-in fade-in duration-300">
      <button 
        onClick={onBack}
        className="text-gray-500 hover:text-teal-600 mb-6 flex items-center gap-2"
      >
        ‚Üê –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É
      </button>

      <div className="flex flex-col md:flex-row gap-12 mb-16">
        {/* Gallery */}
        <div className="w-full md:w-1/2">
          <div className="aspect-square bg-gray-100 rounded-2xl overflow-hidden mb-4">
            <img src={product.image} alt={product.name} className="w-full h-full object-cover" />
          </div>
          <div className="grid grid-cols-4 gap-4">
            {[1, 2, 3].map((i) => (
              <div key={i} className="aspect-square bg-gray-50 rounded-lg cursor-pointer hover:ring-2 ring-teal-500 transition-all">
                {/* Thumbnails placeholder */}
              </div>
            ))}
          </div>
        </div>

        {/* Info */}
        <div className="w-full md:w-1/2">
          <div className="text-sm text-teal-600 font-medium mb-2 uppercase tracking-wide">{product.category}</div>
          <h1 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">{product.name}</h1>
          <div className="text-2xl font-bold text-gray-900 mb-6">{product.price} –≥—Ä–Ω</div>
          
          <p className="text-gray-600 leading-relaxed mb-8">
            {product.description}
            <br /><br />
            –ó–±–∞–≥–∞—á–µ–Ω–∞ –º—ñ–Ω–µ—Ä–∞–ª–∞–º–∏ —Ñ–æ—Ä–º—É–ª–∞, —â–æ –∑–º—ñ—Ü–Ω—é—î –µ–º–∞–ª—å —Ç–∞ –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ –∫–∞—Ä—ñ—î—Å—É. –Ü–¥–µ–∞–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä –¥–ª—è —â–æ–¥–µ–Ω–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.
          </p>

          <div className="flex gap-4 mb-8">
            <button 
              onClick={() => onAddToCart(product)}
              className="flex-1 bg-teal-600 text-white py-4 rounded-xl font-bold hover:bg-teal-700 transition-colors shadow-lg hover:shadow-teal-500/30"
            >
              –î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫
            </button>
            <button className="p-4 rounded-xl border-2 border-gray-200 text-gray-400 hover:border-red-500 hover:text-red-500 transition-colors">
              <Heart size={24} />
            </button>
          </div>

          {/* Perfect Match Block */}
          <div className="bg-gray-50 p-6 rounded-xl border border-gray-100">
            <h3 className="font-bold text-gray-800 mb-4">–Ü–¥–µ–∞–ª—å–Ω–æ –ø–æ—î–¥–Ω—É—î—Ç—å—Å—è –∑:</h3>
            <div className="space-y-4">
               {recommended.map(rec => (
                 <div key={rec.id} className="flex items-center gap-4 bg-white p-2 rounded-lg border border-gray-100">
                   <img src={rec.image} alt={rec.name} className="w-12 h-12 rounded object-cover" />
                   <div className="flex-1">
                     <div className="text-sm font-medium">{rec.name}</div>
                     <div className="text-xs text-gray-500">{rec.price} –≥—Ä–Ω</div>
                   </div>
                   <button 
                    onClick={() => onAddToCart(rec)}
                    className="p-2 text-teal-600 hover:bg-teal-50 rounded"
                   >
                     <ShoppingCart size={16} />
                   </button>
                 </div>
               ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

const CartDrawer = ({ isOpen, onClose, cart, onRemove, products, onAddToCart }) => {
  const total = cart.reduce((sum, item) => sum + item.price, 0);

  // Simple logic for upsell: find cheapest item not in cart
  const upsellItem = products.find(p => p.price < 100 && !cart.some(c => c.id === p.id)) || products[2];

  if (!isOpen) return null;

  return (
    <>
      <div 
        className="fixed inset-0 bg-black/50 z-50 transition-opacity"
        onClick={onClose}
      />
      <div className="fixed inset-y-0 right-0 w-full md:w-[400px] bg-white z-50 shadow-2xl flex flex-col transform transition-transform animate-in slide-in-from-right duration-300">
        <div className="p-6 border-b flex justify-between items-center bg-gray-50">
          <h2 className="text-xl font-bold">–ö–æ—à–∏–∫ ({cart.length})</h2>
          <button onClick={onClose} className="p-2 hover:bg-gray-200 rounded-full">
            <X size={20} />
          </button>
        </div>

        <div className="flex-1 overflow-y-auto p-6">
          {cart.length === 0 ? (
             <div className="text-center text-gray-500 mt-12">
               <ShoppingCart size={48} className="mx-auto mb-4 opacity-30" />
               <p>–í–∞—à –∫–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</p>
             </div>
          ) : (
            <div className="space-y-4">
              {cart.map((item, idx) => (
                <div key={`${item.id}-${idx}`} className="flex gap-4 border-b pb-4">
                  <img src={item.image} alt={item.name} className="w-20 h-20 rounded-lg object-cover bg-gray-100" />
                  <div className="flex-1">
                    <h4 className="font-medium text-sm text-gray-900">{item.name}</h4>
                    <p className="text-gray-500 text-sm mt-1">1 —à—Ç</p>
                    <div className="flex justify-between items-center mt-2">
                      <span className="font-bold">{item.price} –≥—Ä–Ω</span>
                      <button 
                        onClick={() => onRemove(idx)}
                        className="text-red-500 text-xs hover:underline"
                      >
                        –í–∏–¥–∞–ª–∏—Ç–∏
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Upsell Block */}
        <div className="bg-teal-50 p-4 border-t border-teal-100">
          <div className="text-xs font-bold text-teal-800 uppercase mb-2">–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–¥–∞—Ç–∏:</div>
          <div className="flex items-center gap-3 bg-white p-2 rounded-lg shadow-sm">
            <img src={upsellItem.image} alt={upsellItem.name} className="w-12 h-12 rounded object-cover" />
            <div className="flex-1 min-w-0">
               <div className="truncate text-sm font-medium">{upsellItem.name}</div>
               <div className="text-teal-600 font-bold text-sm">{upsellItem.price} –≥—Ä–Ω</div>
            </div>
            <button 
              onClick={() => onAddToCart(upsellItem)}
              className="p-2 bg-teal-100 text-teal-700 rounded hover:bg-teal-200"
            >
              +
            </button>
          </div>
        </div>

        <div className="p-6 border-t bg-white">
          <div className="flex justify-between mb-4 text-lg font-bold">
            <span>–†–∞–∑–æ–º:</span>
            <span>{total} –≥—Ä–Ω</span>
          </div>
          <button className="w-full bg-teal-600 text-white py-4 rounded-xl font-bold hover:bg-teal-700 transition-colors">
            –û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
          </button>
        </div>
      </div>
    </>
  );
};

const Footer = () => (
  <footer className="bg-gray-900 text-white py-12">
    <div className="container mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h4 className="font-bold text-lg mb-4">DENTISTORY</h4>
        <p className="text-gray-400 text-sm">–ù–∞–π–∫—Ä–∞—â–∞ –∫–æ—Å–º–µ—Ç–∏–∫–∞ –¥–ª—è –≤–∞—à–æ—ó –ø–æ—Å–º—ñ—à–∫–∏.</p>
      </div>
      <div>
        <h4 className="font-bold mb-4">–ö–ª—ñ—î–Ω—Ç–∞–º</h4>
        <ul className="space-y-2 text-sm text-gray-400">
          <li>–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–∞ –æ–ø–ª–∞—Ç–∞</li>
          <li>–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è</li>
          <li>–ö–æ–Ω—Ç–∞–∫—Ç–∏</li>
        </ul>
      </div>
      <div>
        <h4 className="font-bold mb-4">–ö–∞—Ç–∞–ª–æ–≥</h4>
        <ul className="space-y-2 text-sm text-gray-400">
          <li>–î–æ—Ä–æ—Å–ª–∏–º</li>
          <li>–î—ñ—Ç—è–º</li>
          <li>–ù–∞–±–æ—Ä–∏</li>
        </ul>
      </div>
      <div>
        <h4 className="font-bold mb-4">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h4>
        <p className="text-gray-400 text-sm">0 800 500 500</p>
        <p className="text-gray-400 text-sm">hello@dentistory.ua</p>
      </div>
    </div>
  </footer>
);

// --- Main App ---

const App = () => {
  const [currentView, setCurrentView] = useState('home'); // 'home', 'catalog', 'product', 'about', 'contacts'
  const [selectedProduct, setSelectedProduct] = useState(null);
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [cart, setCart] = useState([]);
  const [isCartOpen, setIsCartOpen] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");

  const handleNavigate = (view, category = 'all') => {
    setCurrentView(view);
    if (view === 'catalog') {
      setSelectedCategory(category);
    }
    window.scrollTo(0, 0);
  };

  const handleProductClick = (product) => {
    setSelectedProduct(product);
    setCurrentView('product');
    window.scrollTo(0, 0);
  };

  const handleAddToCart = (product) => {
    setCart([...cart, product]);
    setIsCartOpen(true);
  };

  const handleRemoveFromCart = (index) => {
    const newCart = [...cart];
    newCart.splice(index, 1);
    setCart(newCart);
  };

  const handleSearch = (query) => {
      // In a real app, this would filter. 
      // For now, let's just go to catalog and log it.
      setSearchQuery(query);
      handleNavigate('catalog');
  };

  let content;
  switch (currentView) {
    case 'home':
      content = (
        <>
          <Hero onShopNow={() => handleNavigate('catalog')} />
          <BrandAdvantages />
          <VisualCategories onSelectCategory={(cat) => handleNavigate('catalog', cat)} />
          <section className="py-12 bg-gray-50">
             <div className="container mx-auto px-4">
               <div className="flex justify-between items-end mb-8">
                 <h2 className="text-2xl font-bold text-gray-800">–¢–æ–ø –ø—Ä–æ–¥–∞–∂—ñ–≤</h2>
                 <button 
                   onClick={() => handleNavigate('catalog')}
                   className="text-teal-600 font-medium hover:text-teal-800 flex items-center gap-1"
                 >
                   –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å–µ <ArrowRight size={16} />
                 </button>
               </div>
               <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                 {PRODUCTS.slice(0, 4).map(p => (
                   <ProductCard 
                     key={p.id} 
                     product={p} 
                     onClick={handleProductClick}
                     onAddToCart={handleAddToCart}
                   />
                 ))}
               </div>
             </div>
          </section>
        </>
      );
      break;
    case 'catalog':
      content = (
        <Catalog 
          categoryFilter={selectedCategory} 
          products={PRODUCTS}
          onProductClick={handleProductClick}
          onAddToCart={handleAddToCart}
        />
      );
      break;
    case 'product':
      content = (
        <ProductDetail 
          product={selectedProduct} 
          allProducts={PRODUCTS}
          onBack={() => handleNavigate('catalog', selectedProduct?.category || 'all')}
          onAddToCart={handleAddToCart}
        />
      );
      break;
    default:
      content = (
        <div className="min-h-[50vh] flex items-center justify-center">
          <p className="text-xl text-gray-500">–°—Ç–æ—Ä—ñ–Ω–∫–∞ "{currentView}" –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ</p>
        </div>
      );
  }

  return (
    <div className="font-sans text-gray-800 bg-white min-h-screen flex flex-col">
      <Header 
        cartCount={cart.length} 
        onOpenCart={() => setIsCartOpen(true)}
        onNavigate={handleNavigate}
        onSearch={handleSearch}
      />
      
      <main className="flex-grow">
        {content}
      </main>

      <Footer />

      <CartDrawer 
        isOpen={isCartOpen} 
        onClose={() => setIsCartOpen(false)}
        cart={cart}
        onRemove={handleRemoveFromCart}
        products={PRODUCTS}
        onAddToCart={handleAddToCart}
      />
    </div>
  );
};

export default App;
